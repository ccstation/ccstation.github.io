<html lang="en">
	<head>
		<meta charset="utf-8">

		<title>Preview - Notes</title>

		<style>
			body {
				font-family: Helvetica;
			}

			#current-slide,
			#upcoming-slide,
			#speaker-controls {
				padding: 6px;
				box-sizing: border-box;
				-moz-box-sizing: border-box;
			}

			#current-slide iframe,
			#upcoming-slide iframe {
				width: 100%;
				height: 100%;
				border: 1px solid #ddd;
			}

			#current-slide .label,
			#upcoming-slide .label {
				position: absolute;
				top: 10px;
				left: 10px;
				font-weight: bold;
				font-size: 14px;
				z-index: 2;
				color: rgba( 255, 255, 255, 0.9 );
			}

			#current-slide {
				position: fixed;
				width: 100%;
				height: 60%;
				top: 40%;
				left: 0;
				padding-right: 0;
				background-color: #000;

				overflow: scroll;
			}

			#upcoming-slide {
				position: absolute;
				width: 35%;
				height: 40%;
				left: 0;
				top: 0;
			}

			#speaker-controls {
				position: absolute;
				top: 0;
				left: 40%;
				width: 35%;
				height: 40%;
				overflow: auto;

				font-size: 18px;
			}

			#overview {
				position: absolute;
				top: 0;
				left: 0;
				padding-right: 300px;
				padding-bottom: 200px;
				width: 4000px;
				height: 1000px;
				z-index: -99;
			}

				.speaker-controls-time.hidden,
				.speaker-controls-notes.hidden {
					display: none;
				}

				.speaker-controls-time .label,
				.speaker-controls-notes .label {
					text-transform: uppercase;
					font-weight: normal;
					font-size: 0.66em;
					color: #666;
					margin: 0;
				}

				.speaker-controls-time {
					border-bottom: 1px solid rgba( 200, 200, 200, 0.5 );
					margin-bottom: 10px;
					padding: 10px 16px;
					padding-bottom: 20px;
					cursor: pointer;
				}

				.speaker-controls-time .reset-button {
					opacity: 0;
					float: right;
					color: #666;
					text-decoration: none;
				}
				.speaker-controls-time:hover .reset-button {
					opacity: 1;
				}

				.speaker-controls-time .timer,
				.speaker-controls-time .clock {
					width: 50%;
					font-size: 1.9em;
				}

				.speaker-controls-time .timer {
					float: left;
				}

				.speaker-controls-time .clock {
					float: right;
					text-align: right;
				}

				.speaker-controls-time span.mute {
					color: #bbb;
				}

				.speaker-controls-notes {
					padding: 10px 16px;
				}

				.speaker-controls-notes .value {
					margin-top: 5px;
					line-height: 1.4;
					font-size: 1.2em;
				}

			.clear {
				clear: both;
			}

			.box img {
				border: 1px solid #fff;
			}
			.highlight img {
				border: 3px solid #faff00;
			}

			@media screen and (max-width: 1080px) {
				#speaker-controls {
					font-size: 16px;
				}
			}

			@media screen and (max-width: 900px) {
				#speaker-controls {
					font-size: 14px;
				}
			}

			@media screen and (max-width: 800px) {
				#speaker-controls {
					font-size: 12px;
				}
			}

		</style>
	</head>

	<body>

		<div id="upcoming-slide"><span class="label">STAGE:</span></div>
		<div id="speaker-controls">
			<div class="speaker-controls-time">
				<div><input type="checkbox" id="interactive" name="interactive" value="check">Interactive Mode<br></div>
			</div>

			<div class="speaker-controls-notes hidden">
				<h4 class="label">Notes</h4>
				<div class="value"></div>
			</div>
		</div>
		<div class="clear"></div>
		
		<div id="current-slide">
			<div id="overview"></div>
		</div>

		<script src="../../plugin/markdown/marked.js"></script>
		<script>

			(function() {

				var notes,
					notesValue,
					currentState,
					currentSlide,
					upcomingSlide,
					currentH,
					currentV,
					overview,
					slides,
					connected = false;

				window.addEventListener( 'message', function( event ) {
					var data = JSON.parse( event.data );
					// The overview mode is only useful to the reveal.js instance
					// where navigation occurs so we don't sync it
					if( data.state ) delete data.state.overview;

					// Messages sent by the notes plugin inside of the main window
					if( data && data.namespace === 'reveal-notes' ) {
						if( data.type === 'connect' ) {
							handleConnectMessage( data );
						}
						else if( data.type === 'state' ) {
							handleStateMessage( data );
						}
					}
					// Messages sent by the reveal.js inside of the current slide preview
					else if( data && data.namespace === 'reveal' ) {
						if( /ready/.test( data.eventName ) ) {
							// Send a message back to notify that the handshake is complete
							window.opener.postMessage( JSON.stringify({ namespace: 'reveal-notes', type: 'connected'} ), '*' );
						}
						else if( /slidechanged|fragmentshown|fragmenthidden/.test( data.eventName ) && currentState !== JSON.stringify( data.state ) ) {
							if (document.getElementById("interactive").checked) {
								window.opener.postMessage( JSON.stringify({ method: 'setState', args: [ data.state ]} ), '*' );
							}
						}
						else if( /selectslide|paused|resumed/.test( data.eventName ) && currentState !== JSON.stringify( data.state ) ) {
							window.opener.postMessage( JSON.stringify({ method: 'setState', args: [ data.state ]} ), '*' );
						}
					}

				} );

				/**
				 * Called when the main window is trying to establish a
				 * connection.
				 */
				function handleConnectMessage( data ) {

					if( connected === false ) {
						connected = true;

						setupIframes( data );
						//setupKeyboard();
						//setupNotes();
						//setupTimer();
						window.opener.postMessage( JSON.stringify({ namespace: 'reveal-notes', type: 'connected'} ), '*' );
					}

				}

				/**
				 * Called when the main window sends an updated state.
				 */
				function handleStateMessage( data ) {

					// Store the most recently set state to avoid circular loops
					// applying the same state
					currentState = JSON.stringify( data.state );
					
					// // No need for updating the notes in case of fragment changes
					// if ( data.notes ) {
					// 	notes.classList.remove( 'hidden' );
					// 	notesValue.style.whiteSpace = data.whitespace;
					// 	if( data.markdown ) {
					// 		notesValue.innerHTML = marked( data.notes );
					// 	}
					// 	else {
					// 		notesValue.innerHTML = data.notes;
					// 	}
					// }
					// else {
					// 	notes.classList.add( 'hidden' );
					// }

					// Update the note slides
					//currentSlide.contentWindow.postMessage( JSON.stringify({ method: 'setState', args: [ data.state ] }), '*' );
					upcomingSlide.contentWindow.postMessage( JSON.stringify({ method: 'setState', args: [ data.state ] }), '*' );
					//upcomingSlide.contentWindow.postMessage( JSON.stringify({ method: 'next' }), '*' );

				}

				// Limit to max one state update per X ms
				handleStateMessage = debounce( handleStateMessage, 200 );

				/**
				 * Forward keyboard events to the current slide window.
				 * This enables keyboard events to work even if focus
				 * isn't set on the current slide iframe.
				 */
				function setupKeyboard() {

					// document.addEventListener( 'keydown', function( event ) {
					// 	currentSlide.contentWindow.postMessage( JSON.stringify({ method: 'triggerKey', args: [ event.keyCode ] }), '*' );
					// } );

				}

				/**
				 * Creates the preview iframes.
				 */
				function setupIframes( data ) {

					var params = [
						'receiver',
						'progress=false',
						'history=false',
						'transition=none',
						'autoSlide=0',
						'backgroundTransition=none'
					].join( '&' );

					var urlSeparator = /\?/.test(data.url) ? '&' : '?';
					var hash = '#/' + data.state.indexh + '/' + data.state.indexv;
					var currentURL = data.url.replace("index.html", "overview.html") + urlSeparator + params + '&postMessageEvents=true' + hash;
					var upcomingURL = data.url + urlSeparator + params + '&controls=false' + hash;

					// currentSlide = document.createElement( 'iframe' );
					// currentSlide.setAttribute( 'width', 1280 );
					// currentSlide.setAttribute( 'height', 1024 );
					// currentSlide.setAttribute( 'src', currentURL );
					// document.querySelector( '#current-slide' ).appendChild( currentSlide );

					upcomingSlide = document.createElement( 'iframe' );
					upcomingSlide.setAttribute( 'width', 640 );
					upcomingSlide.setAttribute( 'height', 512 );
					upcomingSlide.setAttribute( 'src', upcomingURL );
					document.querySelector( '#upcoming-slide' ).appendChild( upcomingSlide );

				}

				/**
				 * Setup the notes UI.
				 */
				function setupNotes() {

					notes = document.querySelector( '.speaker-controls-notes' );
					notesValue = document.querySelector( '.speaker-controls-notes .value' );

				}

				/**
				 * Create the timer and clock and start updating them
				 * at an interval.
				 */
				function setupTimer() {

					var start = new Date(),
						timeEl = document.querySelector( '.speaker-controls-time' ),
						clockEl = timeEl.querySelector( '.clock-value' ),
						hoursEl = timeEl.querySelector( '.hours-value' ),
						minutesEl = timeEl.querySelector( '.minutes-value' ),
						secondsEl = timeEl.querySelector( '.seconds-value' );

					function _updateTimer() {

						var diff, hours, minutes, seconds,
							now = new Date();

						diff = now.getTime() - start.getTime();
						hours = Math.floor( diff / ( 1000 * 60 * 60 ) );
						minutes = Math.floor( ( diff / ( 1000 * 60 ) ) % 60 );
						seconds = Math.floor( ( diff / 1000 ) % 60 );

						clockEl.innerHTML = now.toLocaleTimeString( 'en-US', { hour12: true, hour: '2-digit', minute:'2-digit' } );
						hoursEl.innerHTML = zeroPadInteger( hours );
						hoursEl.className = hours > 0 ? '' : 'mute';
						minutesEl.innerHTML = ':' + zeroPadInteger( minutes );
						minutesEl.className = minutes > 0 ? '' : 'mute';
						secondsEl.innerHTML = ':' + zeroPadInteger( seconds );

					}

					// Update once directly
					_updateTimer();

					// Then update every second
					setInterval( _updateTimer, 1000 );

					timeEl.addEventListener( 'click', function() {
						start = new Date();
						_updateTimer();
						return false;
					} );

				}

				function zeroPadInteger( num ) {

					var str = '00' + parseInt( num );
					return str.substring( str.length - 2 );

				}

				/**
				 * Limits the frequency at which a function can be called.
				 */
				function debounce( fn, ms ) {

					var lastTime = 0,
						timeout;

					return function() {

						var args = arguments;
						var context = this;

						clearTimeout( timeout );

						var timeSinceLastCall = Date.now() - lastTime;
						if( timeSinceLastCall > ms ) {
							fn.apply( context, args );
							lastTime = Date.now();
						}
						else {
							timeout = setTimeout( function() {
								fn.apply( context, args );
								lastTime = Date.now();
							}, ms - timeSinceLastCall );
						}

					}

				}



	function init() {
		currentH = 1;
		currentV = 1;

		overview = document.getElementById("overview");
		slides = [
{"seq":1, "h":1, "v":1},
{"seq":2, "h":2, "v":1},
{"seq":3, "h":2, "v":2},
{"seq":4, "h":2, "v":3},
{"seq":5, "h":2, "v":4},
{"seq":6, "h":2, "v":5},
{"seq":7, "h":2, "v":6},
{"seq":8, "h":3, "v":1},
{"seq":9, "h":3, "v":2},
{"seq":10, "h":3, "v":3},
{"seq":11, "h":3, "v":4},
{"seq":12, "h":3, "v":5},
{"seq":13, "h":4, "v":1},
{"seq":14, "h":4, "v":2},
{"seq":15, "h":4, "v":3},
{"seq":16, "h":4, "v":4},
{"seq":17, "h":4, "v":5},
{"seq":18, "h":5, "v":1},
{"seq":19, "h":5, "v":2},
{"seq":20, "h":5, "v":3},
{"seq":21, "h":6, "v":1},
{"seq":22, "h":6, "v":2},
{"seq":23, "h":7, "v":1},
{"seq":24, "h":7, "v":2},
{"seq":25, "h":7, "v":3},
{"seq":26, "h":7, "v":4},
{"seq":27, "h":7, "v":5},
{"seq":28, "h":7, "v":6},
{"seq":29, "h":7, "v":7},
{"seq":30, "h":8, "v":1},
{"seq":31, "h":8, "v":2},
{"seq":32, "h":8, "v":3},
{"seq":33, "h":8, "v":4},
{"seq":34, "h":8, "v":5},
{"seq":35, "h":8, "v":6},
{"seq":36, "h":8, "v":7},
{"seq":37, "h":8, "v":8},
{"seq":38, "h":8, "v":9},
{"seq":39, "h":9, "v":1},
{"seq":40, "h":9, "v":2},
{"seq":41, "h":9, "v":3},
{"seq":42, "h":9, "v":4},
{"seq":43, "h":9, "v":5},
{"seq":44, "h":9, "v":6},
{"seq":45, "h":9, "v":7},
{"seq":46, "h":9, "v":8},
{"seq":47, "h":9, "v":9},
{"seq":48, "h":9, "v":10},
{"seq":49, "h":10, "v":1},
{"seq":50, "h":11, "v":1},
{"seq":51, "h":11, "v":2},
{"seq":52, "h":11, "v":3},
{"seq":53, "h":11, "v":4},
{"seq":54, "h":11, "v":5},
{"seq":55, "h":12, "v":1},
{"seq":56, "h":12, "v":2},
{"seq":57, "h":12, "v":3},
{"seq":58, "h":12, "v":4},
{"seq":59, "h":12, "v":5},
{"seq":60, "h":12, "v":6},
{"seq":61, "h":12, "v":7},
{"seq":62, "h":12, "v":8},
{"seq":63, "h":12, "v":9},
{"seq":64, "h":13, "v":1},
{"seq":65, "h":13, "v":2},
{"seq":66, "h":13, "v":3},
{"seq":67, "h":13, "v":4},
{"seq":68, "h":13, "v":5},
{"seq":69, "h":14, "v":1},
{"seq":70, "h":14, "v":2},
{"seq":71, "h":14, "v":3},
{"seq":72, "h":14, "v":4},
{"seq":73, "h":14, "v":5},
{"seq":74, "h":15, "v":1},
{"seq":75, "h":15, "v":2},
{"seq":76, "h":15, "v":3},
{"seq":77, "h":15, "v":4},
{"seq":78, "h":15, "v":5},
{"seq":79, "h":15, "v":6},
{"seq":80, "h":15, "v":7},
{"seq":81, "h":15, "v":8},
{"seq":82, "h":15, "v":9},
{"seq":83, "h":15, "v":10},
{"seq":84, "h":15, "v":11},
{"seq":85, "h":16, "v":1},
{"seq":851, "h":16, "v":2},
{"seq":852, "h":16, "v":3},
{"seq":86, "h":17, "v":1},
{"seq":87, "h":17, "v":2},
{"seq":88, "h":17, "v":3},
{"seq":89, "h":17, "v":4},
{"seq":90, "h":17, "v":5},
{"seq":91, "h":18, "v":1},
{"seq":92, "h":18, "v":2},
{"seq":93, "h":18, "v":3},
{"seq":94, "h":19, "v":1},
{"seq":95, "h":19, "v":2},
{"seq":96, "h":19, "v":3},
{"seq":97, "h":19, "v":4},
{"seq":98, "h":19, "v":5}
		];

	}

	function draw() {
		for (i in slides) {
			var s = slides[i];
			addBox(s.seq, s.h, s.v, "/overview_images/slide_" + s.seq + ".png");
		}
	}

	var width = 150;
	var height = 120;
	var padding = 5;
		

	function addBox(seq, h, v, imgsrc) {
		var box = document.createElement("div");
		box.className = "box";
		box.id = "box_" + h + "_" + v;
		box.style.position = "absolute";
		box.style.left = h*(width + padding*2);
		box.style.top = v*(height + padding*2);
		box.style.width = width;
		box.style.height = height;
		box.style.margin = padding;
		box.style.display = "block";

		var imgElem = document.createElement("img");
		imgElem.src = imgsrc;
		imgElem.data = seq;
		imgElem.width = width;
		imgElem.onclick = function() {
			highlight(h, v);
		};
		box.appendChild(imgElem);

		overview.appendChild(box);
	}

	function highlight(h, v) {
		if (h <= 0 || v <= 0) {
			return;
		}
		var box1 = document.getElementById("box_" + h + "_" + v);
		if (box1) {
			// remove existing highlight
			var box = document.getElementById("box_" + currentH + "_" + currentV);
			removeClass(box, "highlight");
			addClass(box1, "highlight");
			
			currentV = v;
			currentH = h
		
			if (document.getElementById("interactive").checked) {
				var state = {indexh:h-1, indexv:v-1, paused:false, overview: false};
				window.opener.postMessage( JSON.stringify({ method: 'setState', args: [ state ]} ), '*' );
			}
		}

		moveOverviewBox(h, v);
	}

	function moveOverviewBox(h, v) {
		var offset_w = window.innerWidth/2
		if (h * width > offset_w) {
			overview.style.left = -1 * h * width + offset_w;
		}

		var offset_h = window.innerHeight * .6 /2
		if (v * height > offset_h) {
			overview.style.top = -1 * v * height + offset_h;
		}
		if (v * height < offset_h) {
			overview.style.top = 0;
		}
	}



	function addClass(element, className){
	    if (!element || !className){
	        return;
	    }

	    var classString = element.className, nameIndex = classString.indexOf(className);
	    if (nameIndex == -1) {
	        classString += ' ' + className;
	    }
	    element.className = classString;
	}

	function removeClass(element, className){
	    if (!element || !className){
	        return;
	    }

	    var classString = element.className, nameIndex = classString.indexOf(className);
	    if (nameIndex != -1) {
	        classString = classString.substr(0, nameIndex) + classString.substr(nameIndex+className.length);
	    }
	    element.className = classString;
	}

	function navigateLeft() {
		highlight(currentH-1, 1);	
	}
	function navigateRight() {
		highlight(currentH+1, 1);	
	}
	function navigateUp() {
		highlight(currentH, currentV-1);	
	}
	function navigateDown() {
		highlight(currentH, currentV+1);	
	}
	function togglePause() {
		var state = {indexh:currentH-1, indexv:currentV-1, paused:true, overview: false};
		window.opener.postMessage( JSON.stringify({ method: 'setState', args: [ state ]} ), '*' );
	}
	function showCurrentSlide() {
		var state = {indexh:currentH-1, indexv:currentV-1, paused:false, overview: false};
		window.opener.postMessage( JSON.stringify({ method: 'setState', args: [ state ]} ), '*' );
	}

	document.addEventListener("keydown", function(event) {
	  	switch( event.which ) {
			// p, page up
			case 80: case 33: navigatePrev(); break;
			// n, page down
			case 78: case 34: navigateNext(); break;
			// h, left
			case 72: case 37: navigateLeft(); break;
			// l, right
			case 76: case 39: navigateRight(); break;
			// k, up
			case 75: case 38: navigateUp(); break;
			// j, down
			case 74: case 40: navigateDown(); break;
			//case 13: isOverview() ? deactivateOverview() : triggered = false; break;
			case 13: showCurrentSlide(); break;
			// two-spot, semicolon, b, period, Logitech presenter tools "black screen" button
			case 58: case 59: case 66: case 190: case 191: togglePause(); break;
			// 1
			case 49: event.shiftKey ? highlight( currentH, 11) : highlight( currentH, 1 ); break; 
			// 2
			case 50: event.shiftKey ? highlight( currentH, 12) : highlight( currentH, 2 ); break;
			// 3
			case 51: event.shiftKey ? highlight( currentH, 13) : highlight( currentH, 3 ); break;
			// 4
			case 52: event.shiftKey ? highlight( currentH, 14) : highlight( currentH, 4 ); break;
			// 5
			case 53: event.shiftKey ? highlight( currentH, 15) : highlight( currentH, 5 ); break;
			// 6
			case 54: event.shiftKey ? highlight( currentH, 16) : highlight( currentH, 6 ); break;
			// 7
			case 55: event.shiftKey ? highlight( currentH, 17) : highlight( currentH, 7 ); break;
			// 8
			case 56: event.shiftKey ? highlight( currentH, 18) : highlight( currentH, 8 ); break;
			// 9
			case 57: event.shiftKey ? highlight( currentH, 19) : highlight( currentH, 9 ); break;
			// 0
			case 48: event.shiftKey ? highlight( currentH, 20) : highlight( currentH, 10 ); break;
		}
		event.preventDefault && event.preventDefault();
	});

init();
draw();
highlight(1,1);


			})();

		</script>
	</body>
</html>
